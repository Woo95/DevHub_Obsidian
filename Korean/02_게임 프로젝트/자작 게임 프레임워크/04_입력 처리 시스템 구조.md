# **입력 처리 시스템 구조**
---
## **개요**
게임 내 입력을 관리하는 입력 처리 시스템은 `CInputManager`와 `CInputComponent`로 구성되며, 키보드/마우스 입력 상태와 이를 **바인딩하는 구조체**를 통해 동작합니다. 각 오브젝트는 자신에게 필요한 입력을 바인딩하고, 발생한 입력에 따라 **연결된 콜백 함수**를 실행합니다. 

> **이 시스템의 주요 장점**은 여러 콜백 함수에 대해 키보드와 마우스의 다양한 입력 조건(입력값 + 입력상태)을 조합해 처리할 수 있어, **입력 방식을 유연하게 설계하고 확장할 수 있다는 점**입니다.
---
## **입력 시스템 작동 구조 | [[Input System Architecture Diagram_Kor.png|자세히 보기]]**
![[Input System Architecture Diagram_Kor.png]]

- 실행 순서: `Initialization` → `Update`
- 본 설계도는 **입력 매니저**(CInputManager)와 **입력 컴포넌트**(CInputComponent) 두 클래스 간의 **연계성**을 간단히 보여줍니다.

---
## **InputUtils.h 구성 요소 및 설명**
키보드와 마우스의 입력값, 입력상태, 이벤트 바인딩을 관리하며, 게임 내 입력 처리를 위해 필요한 공통 자료형과 구조체들을 정의하는 유틸 항목입니다.
### `1. EKeyAction 열거형 클래스`
![[Self-Made Game Framework (Code)#^0b8d0a]]
- 키 입력타입을 구분하기 위한 열거형 클래스입니다.
---
### `2. FKeyState 구조체`
![[Self-Made Game Framework (Code)#^186449]]
- 단일 키의 현재 입력상태를 저장하는 구조체입니다.
---
### `3. FBindFunction 구조체`
![[Self-Made Game Framework (Code)#^0cf9f9]]
- 오브젝트 포인터와 함수(콜백)을 한 쌍으로 보관하는 구조체입니다.
---
### `4. FBinder 구조체`
![[Self-Made Game Framework (Code)#^1318b8]]
- 키보드와 마우스 입력을 조합하고, 해당 입력에 대한 동작(콜백 함수)을 함께 묶어주는 구조체입니다.
---
## **클래스 목록 및 설명**
### `1. CInputManager 클래스`
![[Self-Made Game Framework (Code)#^1fdcb1]]
- **역할**:
	- **전역 싱글톤**으로 동작하며, 등록된 키보드와 마우스 **입력상태를 관리**합니다.
	- 매 프레임마다 등록된 키보드와 마우스 **입력을 감지**하고, **입력상태를 업데이트**합니다.
- **핵심 변수들**:
	- `mKeys`:
		- 등록된 키보드 키들의 **입력값과 입력상태를 저장**합니다.
	- `mMouses`:
		- 등록된 마우스 버튼들의 **입력값과 입력상태를 저장**합니다.
- **핵심 함수들**:
	- [[Self-Made Game Framework (Code)#^9a862b|bool RegisterKey(SDL_Scancode keyCode)]]:
		- 사용할 키보드 키를 `mKeys`에 등록합니다.
	- [[Self-Made Game Framework (Code)#^991446|bool RegisterMouse(Uint8 button)]]:
		- 사용할 마우스 버튼을 `mMouses`에 등록합니다.
	- [[Self-Made Game Framework (Code)#^242c9b|void UpdateInputState()]]:
		- 매 프레임마다 등록된 `mKeys`와 `mMouses`의 **입력상태를 감지**합니다.
	- [[Self-Made Game Framework (Code)#^646ee8|void HandleInputState(bool& press, bool& hold, bool& release, bool isPressed)]]:
		- `UpdateInputState()`에서 호출됩니다.
		- 등록된 `mKeys`와 `mMouses`의 **입력상태를 업데이트**합니다.
	- [[Self-Made Game Framework (Code)#^a61a23|bool GetKeyState(SDL_Scancode keyCode, EKeyAction action)]]:
		- 특정 키보드 키의 현재 **입력상태를 확인**합니다.
	- [[Self-Made Game Framework (Code)#^7fc416|bool GetMouseButtonState(Uint8 button, EKeyAction action)]]:
		- 특정 마우스 버튼의 현재 **입력상태를 확인**합니다.
---
### `2. CInputComponent 클래스`
![[Self-Made Game Framework (Code)#^a6482f]]
- **역할**:
	- 오브젝트 단위로 `mBinders`에 **입력 조건**(입력값, 입력상태)**과 콜백 함수를 등록**하며, **입력 조건과 일치하면 콜백 함수를 실행**합니다.
- **핵심 변수**:
	- `mBinders`:
		- 문자열 키를 기준으로 `FBinder`를 저장하며, 각 바인더에 **입력 조건**(입력값 + 입력상태)하고 **콜백 함수를 보관**합니다.
- **핵심 함수들**:
	- [[Self-Made Game Framework (Code)#^196a5f|virtual void Update(float deltaTime)]]:
		- `mBinders`에 등록된 입력 조건을 `CInputManager`와 비교해, 일치하면 **콜백 함수를 실행**합니다.
	- [[Self-Made Game Framework (Code)#^22375e|void AddFunctionToBinder(...) & void AddFunctionToBinder\<T\>(...)]]:
		- 문자열 키를 기준으로 `mBinders`에 **콜백 함수를 등록**합니다.
	- [[Self-Made Game Framework (Code)#^94cde9|void DeleteFunctionFromBinder(const std::string& key, void* obj)]]:
		- 문자열 키를 기준으로 `mBinders`에 등록된 **콜백 함수를 제거**합니다.
	- [[Self-Made Game Framework (Code)#^cc72ca|void AddInputToBinder(...)]]:
		- 문자열 키를 기준으로 `mBinders`에 **입력 조건를 등록**합니다.
---
## **맺는 말**

> 이번 구현을 통해 **입력 매니저**(CInputManager)와 **입력 컴포넌트**(CInputComponent)를 분리하여 관리하면, **사용자 정의 키 매핑**이나 **다양한 입력 패턴, 복잡한 입력 조건**도 **깔끔하게 처리**할 수 있다는 점을 배웠습니다. 또한, **유연하고 확장성 있게 설계**하는 관점에서 입력 시스템을 구성하는 방법을 깊이 이해하게 되었습니다.